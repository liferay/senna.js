{"version":3,"sources":["HtmlScreen.js"],"names":["HtmlScreen","titleSelector","releaseVirtualDocument","pendingStyles","htmlString","virtualDocument","document","createElement","copyNodeAttributesFromContent_","innerHTML","newStyle","isTemporaryStyle","selectors","stylesTemporary","push","id","styleInDoc","getElementById","parentNode","insertBefore","nextSibling","head","appendChild","bodySurface","querySelector","body","content","node","replace","placeholder","clearNodeAttributes","copyNodeAttributes","disposePendingStyles","forEach","style","surfaces","evaluateTrackedScripts","evaluateTrackedResources_","runScriptsInElement","scripts","scriptsTemporary","scriptsPermanent","then","evaluateTrackedStyles","runStylesInElement","styles","stylesPermanent","appendStyleIntoDocument_","bind","evaluatorFn","selector","selectorTemporary","selectorPermanent","opt_appendResourceFn","tracked","virtualQuerySelectorAll_","temporariesInDoc","querySelectorAll_","permanentsInDoc","resource","resourceKey","getResourceKey_","permanentResourcesInDoc","frag","resolve","documentElement","href","src","surfaceId","surface","defaultChild","DEFAULT","path","allocateVirtualDocumentForContent","resolveTitleFromVirtualDocument","assertSameBodyIdInVirtualDocument","isIe","makeTemporaryStylesHrefsUnique_","replaceStyleAndMakeUnique_","tagName","makeUnique","toString","replaceChild","disabled","Array","prototype","slice","call","querySelectorAll","title","setTitle","textContent","trim"],"mappings":"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","file":"src/screen/HtmlScreen.js","sourcesContent":["'use strict';\n\nimport { getUid } from 'metal';\nimport { buildFragment, exitDocument, globalEval, globalEvalStyles, match } from 'metal-dom';\nimport CancellablePromise from 'metal-promise';\nimport globals from '../globals/globals';\nimport RequestScreen from './RequestScreen';\nimport Surface from '../surface/Surface';\nimport UA from 'metal-useragent';\nimport Uri from 'metal-uri';\nimport utils from '../utils/utils';\n\nclass HtmlScreen extends RequestScreen {\n\n\t/**\n\t * Screen class that perform a request and extracts surface contents from\n\t * the response content.\n\t * @constructor\n\t * @extends {RequestScreen}\n\t */\n\tconstructor() {\n\t\tsuper();\n\n\t\t/**\n\t\t * Holds the title selector. Relevant to extract the <code><title></code>\n\t\t * element from request fragments to use as the screen title.\n\t\t * @type {!string}\n\t\t * @default title\n\t\t * @protected\n\t\t */\n\t\tthis.titleSelector = 'title';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tactivate() {\n\t\tsuper.activate();\n\t\tthis.releaseVirtualDocument();\n\t\tthis.pendingStyles = null;\n\t}\n\n\t/**\n\t * Allocates virtual document for content. After allocated virtual document\n\t * can be accessed by <code>this.virtualDocument</code>.\n\t * @param {!string} htmlString\n\t */\n\tallocateVirtualDocumentForContent(htmlString) {\n\t\tif (!this.virtualDocument) {\n\t\t\tthis.virtualDocument = globals.document.createElement('html');\n\t\t}\n\n\t\tthis.copyNodeAttributesFromContent_(htmlString, this.virtualDocument);\n\n\t\tthis.virtualDocument.innerHTML = htmlString;\n\t}\n\n\t/**\n\t * Customizes logic to append styles into document. Relevant to when\n\t * tracking a style by id make sure to re-positions the new style in the\n\t * same dom order.\n\t * @param {Element} newStyle\n\t */\n\tappendStyleIntoDocument_(newStyle) {\n\t\tvar isTemporaryStyle = match(newStyle, HtmlScreen.selectors.stylesTemporary);\n\t\tif (isTemporaryStyle) {\n\t\t\tthis.pendingStyles.push(newStyle);\n\t\t}\n\t\tif (newStyle.id) {\n\t\t\tvar styleInDoc = globals.document.getElementById(newStyle.id);\n\t\t\tif (styleInDoc) {\n\t\t\t\tstyleInDoc.parentNode.insertBefore(newStyle, styleInDoc.nextSibling);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tglobals.document.head.appendChild(newStyle);\n\t}\n\n\t/**\n\t * If body is used as surface forces the requested documents to have same id\n\t * of the initial page.\n\t */\n\tassertSameBodyIdInVirtualDocument() {\n\t\tvar bodySurface = this.virtualDocument.querySelector('body');\n\t\tif (!globals.document.body.id) {\n\t\t\tglobals.document.body.id = 'senna_surface_' + getUid();\n\t\t}\n\t\tif (bodySurface) {\n\t\t\tbodySurface.id = globals.document.body.id;\n\t\t}\n\t}\n\n\t/**\n\t * Copies attributes from the <html> tag of content to the given node.\n\t */\n\tcopyNodeAttributesFromContent_(content, node) {\n\t\tcontent = content.replace(/[<]\\s*html/ig, '<senna');\n\t\tcontent = content.replace(/\\/html\\s*\\>/ig, '/senna>');\n\t\tnode.innerHTML = content;\n\t\tvar placeholder = node.querySelector('senna');\n\t\tif (placeholder) {\n\t\t\tutils.clearNodeAttributes(node);\n\t\t\tutils.copyNodeAttributes(placeholder, node);\n\t\t}\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tdisposeInternal() {\n\t\tthis.disposePendingStyles();\n\t\tsuper.disposeInternal();\n\t}\n\n\t/**\n\t * Disposes pending styles if screen get disposed prior to its loading.\n\t */\n\tdisposePendingStyles() {\n\t\tif (this.pendingStyles) {\n\t\t\tthis.pendingStyles.forEach((style) => exitDocument(style));\n\t\t}\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tevaluateScripts(surfaces) {\n\t\tvar evaluateTrackedScripts = this.evaluateTrackedResources_(\n\t\t\tglobalEval.runScriptsInElement, HtmlScreen.selectors.scripts,\n\t\t\tHtmlScreen.selectors.scriptsTemporary, HtmlScreen.selectors.scriptsPermanent);\n\n\t\treturn evaluateTrackedScripts.then(() => super.evaluateScripts(surfaces));\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tevaluateStyles(surfaces) {\n\t\tthis.pendingStyles = [];\n\t\tvar evaluateTrackedStyles = this.evaluateTrackedResources_(\n\t\t\tglobalEvalStyles.runStylesInElement, HtmlScreen.selectors.styles,\n\t\t\tHtmlScreen.selectors.stylesTemporary, HtmlScreen.selectors.stylesPermanent,\n\t\t\tthis.appendStyleIntoDocument_.bind(this));\n\n\t\treturn evaluateTrackedStyles.then(() => super.evaluateStyles(surfaces));\n\t}\n\n\t/**\n\t * Evaluates tracked resources inside incoming fragment and remove existing\n\t * temporary resources.\n\t * @param {?function()} appendFn Function to append the node into document.\n\t * @param {!string} selector Selector used to find resources to track.\n\t * @param {!string} selectorTemporary Selector used to find temporary\n\t *     resources to track.\n\t * @param {!string} selectorPermanent Selector used to find permanent\n\t *     resources to track.\n\t * @param {!function} opt_appendResourceFn Optional function used to\n\t *     evaluate fragment containing resources.\n\t * @return {CancellablePromise} Deferred that waits resources evaluation to\n\t *     complete.\n\t * @private\n\t */\n\tevaluateTrackedResources_(evaluatorFn, selector, selectorTemporary, selectorPermanent, opt_appendResourceFn) {\n\t\tvar tracked = this.virtualQuerySelectorAll_(selector);\n\t\tvar temporariesInDoc = this.querySelectorAll_(selectorTemporary);\n\t\tvar permanentsInDoc = this.querySelectorAll_(selectorPermanent);\n\n\t\t// Adds permanent resources in document to cache.\n\t\tpermanentsInDoc.forEach((resource) => {\n\t\t\tvar resourceKey = this.getResourceKey_(resource);\n\t\t\tif (resourceKey) {\n\t\t\t\tHtmlScreen.permanentResourcesInDoc[resourceKey] = true;\n\t\t\t}\n\t\t});\n\n\t\tvar frag = buildFragment();\n\t\ttracked.forEach((resource) => {\n\t\t\tvar resourceKey = this.getResourceKey_(resource);\n\t\t\t// Do not load permanent resources if already in document.\n\t\t\tif (!HtmlScreen.permanentResourcesInDoc[resourceKey]) {\n\t\t\t\tfrag.appendChild(resource);\n\t\t\t}\n\t\t\t// If resource has key and is permanent add to cache.\n\t\t\tif (resourceKey && match(resource, selectorPermanent)) {\n\t\t\t\tHtmlScreen.permanentResourcesInDoc[resourceKey] = true;\n\t\t\t}\n\t\t});\n\n\t\treturn new CancellablePromise((resolve) => {\n\t\t\tevaluatorFn(frag, () => {\n\t\t\t\ttemporariesInDoc.forEach((resource) => exitDocument(resource));\n\t\t\t\tresolve();\n\t\t\t}, opt_appendResourceFn);\n\t\t});\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tflip(surfaces) {\n\t\treturn super.flip(surfaces).then(() => {\n\t\t\tutils.clearNodeAttributes(document.documentElement);\n\t\t\tutils.copyNodeAttributes(this.virtualDocument, document.documentElement);\n\t\t});\n\t}\n\n\t/**\n\t * Extracts a key to identify the resource based on its attributes.\n\t * @param {Element} resource\n\t * @return {string} Extracted key based on resource attributes in order of\n\t *     preference: id, href, src.\n\t */\n\tgetResourceKey_(resource) {\n\t\treturn resource.id || resource.href || resource.src || '';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetSurfaceContent(surfaceId) {\n\t\tvar surface = this.virtualDocument.querySelector('#' + surfaceId);\n\t\tif (surface) {\n\t\t\tvar defaultChild = surface.querySelector('#' + surfaceId + '-' + Surface.DEFAULT);\n\t\t\tif (defaultChild) {\n\t\t\t\treturn defaultChild.innerHTML;\n\t\t\t}\n\t\t\treturn surface.innerHTML; // If default content not found, use surface content\n\t\t}\n\t}\n\n\t/**\n\t * Gets the title selector.\n\t * @return {!string}\n\t */\n\tgetTitleSelector() {\n\t\treturn this.titleSelector;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tload(path) {\n\t\treturn super.load(path)\n\t\t\t.then(content => {\n\t\t\t\tthis.allocateVirtualDocumentForContent(content);\n\t\t\t\tthis.resolveTitleFromVirtualDocument();\n\t\t\t\tthis.assertSameBodyIdInVirtualDocument();\n\t\t\t\tif (UA.isIe) {\n\t\t\t\t\tthis.makeTemporaryStylesHrefsUnique_();\n\t\t\t\t}\n\t\t\t\treturn content;\n\t\t\t});\n\t}\n\n\t/**\n\t * Queries temporary styles from virtual document, and makes them unique.\n\t * This is necessary for caching and load event firing issues specific to\n\t * IE11. https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7940171/\n\t */\n\tmakeTemporaryStylesHrefsUnique_() {\n\t\tvar temporariesInDoc = this.virtualQuerySelectorAll_(HtmlScreen.selectors.stylesTemporary);\n\t\ttemporariesInDoc.forEach((style) => this.replaceStyleAndMakeUnique_(style));\n\t}\n\n\t/**\n\t * Creates a new element from given, copies attributes, mutates href to be\n\t * unique to prevent caching and more than one load/error event from firing.\n\t */\n\treplaceStyleAndMakeUnique_(style) {\n\t\tif (style.href) {\n\t\t\tvar newStyle = globals.document.createElement(style.tagName);\n\t\t\tstyle.href = new Uri(style.href).makeUnique().toString();\n\t\t\tutils.copyNodeAttributes(style, newStyle);\n\t\t\tstyle.parentNode.replaceChild(newStyle, style);\n\t\t\tstyle.disabled = true;\n\t\t}\n\t}\n\n\t/**\n\t * Queries elements from virtual document and returns an array of elements.\n\t * @param {!string} selector\n\t * @return {array.<Element>}\n\t */\n\tvirtualQuerySelectorAll_(selector) {\n\t\treturn Array.prototype.slice.call(this.virtualDocument.querySelectorAll(selector));\n\t}\n\n\t/**\n\t * Queries elements from document and returns an array of elements.\n\t * @param {!string} selector\n\t * @return {array.<Element>}\n\t */\n\tquerySelectorAll_(selector) {\n\t\treturn Array.prototype.slice.call(globals.document.querySelectorAll(selector));\n\t}\n\n\t/**\n\t * Releases virtual document allocated for content.\n\t */\n\treleaseVirtualDocument() {\n\t\tthis.virtualDocument = null;\n\t}\n\n\t/**\n\t * Resolves title from allocated virtual document.\n\t */\n\tresolveTitleFromVirtualDocument() {\n\t\tvar title = this.virtualDocument.querySelector(this.titleSelector);\n\t\tif (title) {\n\t\t\tthis.setTitle(title.textContent.trim());\n\t\t}\n\t}\n\n\t/**\n\t * Sets the title selector.\n\t * @param {!string} titleSelector\n\t */\n\tsetTitleSelector(titleSelector) {\n\t\tthis.titleSelector = titleSelector;\n\t}\n\n}\n\n/**\n * Helper selectors for tracking resources.\n * @type {object}\n * @protected\n * @static\n */\nHtmlScreen.selectors = {\n\tscripts: 'script[data-senna-track]',\n\tscriptsPermanent: 'script[data-senna-track=\"permanent\"]',\n\tscriptsTemporary: 'script[data-senna-track=\"temporary\"]',\n\tstyles: 'style[data-senna-track],link[data-senna-track]',\n\tstylesPermanent: 'style[data-senna-track=\"permanent\"],link[data-senna-track=\"permanent\"]',\n\tstylesTemporary: 'style[data-senna-track=\"temporary\"],link[data-senna-track=\"temporary\"]'\n};\n\n/**\n * Caches permanent resource keys.\n * @type {object}\n * @protected\n * @static\n */\nHtmlScreen.permanentResourcesInDoc = {};\n\nexport default HtmlScreen;\n"],"sourceRoot":"/source/"}