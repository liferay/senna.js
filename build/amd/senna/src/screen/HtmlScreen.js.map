{"version":3,"sources":["HtmlScreen.js"],"names":["HtmlScreen","titleSelector","releaseVirtualDocument","pendingStyles","htmlString","virtualDocument","document","createElement","copyNodeAttributesFromContent_","innerHTML","newStyle","isTemporaryStyle","match","selectors","stylesTemporary","push","id","styleInDoc","getElementById","parentNode","insertBefore","nextSibling","head","appendChild","bodySurface","querySelector","body","getUid","content","node","replace","placeholder","clearNodeAttributes","copyNodeAttributes","disposePendingStyles","forEach","style","exitDocument","surfaces","evaluateTrackedScripts","evaluateTrackedResources_","runScriptsInElement","scripts","scriptsTemporary","scriptsPermanent","then","evaluateTrackedStyles","runStylesInElement","styles","stylesPermanent","appendStyleIntoDocument_","bind","evaluatorFn","selector","selectorTemporary","selectorPermanent","opt_appendResourceFn","tracked","virtualQuerySelectorAll_","temporariesInDoc","querySelectorAll_","permanentsInDoc","resource","resourceKey","getResourceKey_","permanentResourcesInDoc","frag","buildFragment","resolve","documentElement","href","src","surfaceId","surface","defaultChild","DEFAULT","path","allocateVirtualDocumentForContent","resolveTitleFromVirtualDocument","assertSameBodyIdInVirtualDocument","isIe","makeTemporaryStylesHrefsUnique_","replaceStyleAndMakeUnique_","tagName","makeUnique","toString","replaceChild","disabled","Array","prototype","slice","call","querySelectorAll","title","setTitle","trim"],"mappings":"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","file":"src/screen/HtmlScreen.js","sourcesContent":["'use strict';\n\nimport { core } from 'metal';\nimport { dom, globalEval, globalEvalStyles } from 'metal-dom';\nimport CancellablePromise from 'metal-promise';\nimport globals from '../globals/globals';\nimport RequestScreen from './RequestScreen';\nimport Surface from '../surface/Surface';\nimport UA from 'metal-useragent';\nimport Uri from 'metal-uri';\nimport utils from '../utils/utils';\n\nclass HtmlScreen extends RequestScreen {\n\n\t/**\n\t * Screen class that perform a request and extracts surface contents from\n\t * the response content.\n\t * @constructor\n\t * @extends {RequestScreen}\n\t */\n\tconstructor() {\n\t\tsuper();\n\n\t\t/**\n\t\t * Holds the title selector. Relevant to extract the <code><title></code>\n\t\t * element from request fragments to use as the screen title.\n\t\t * @type {!string}\n\t\t * @default title\n\t\t * @protected\n\t\t */\n\t\tthis.titleSelector = 'title';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tactivate() {\n\t\tsuper.activate();\n\t\tthis.releaseVirtualDocument();\n\t\tthis.pendingStyles = null;\n\t}\n\n\t/**\n\t * Allocates virtual document for content. After allocated virtual document\n\t * can be accessed by <code>this.virtualDocument</code>.\n\t * @param {!string} htmlString\n\t */\n\tallocateVirtualDocumentForContent(htmlString) {\n\t\tif (!this.virtualDocument) {\n\t\t\tthis.virtualDocument = globals.document.createElement('html');\n\t\t}\n\n\t\tthis.copyNodeAttributesFromContent_(htmlString, this.virtualDocument);\n\n\t\tthis.virtualDocument.innerHTML = htmlString;\n\t}\n\n\t/**\n\t * Customizes logic to append styles into document. Relevant to when\n\t * tracking a style by id make sure to re-positions the new style in the\n\t * same dom order.\n\t * @param {Element} newStyle\n\t */\n\tappendStyleIntoDocument_(newStyle) {\n\t\tvar isTemporaryStyle = dom.match(newStyle, HtmlScreen.selectors.stylesTemporary);\n\t\tif (isTemporaryStyle) {\n\t\t\tthis.pendingStyles.push(newStyle);\n\t\t}\n\t\tif (newStyle.id) {\n\t\t\tvar styleInDoc = globals.document.getElementById(newStyle.id);\n\t\t\tif (styleInDoc) {\n\t\t\t\tstyleInDoc.parentNode.insertBefore(newStyle, styleInDoc.nextSibling);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tglobals.document.head.appendChild(newStyle);\n\t}\n\n\t/**\n\t * If body is used as surface forces the requested documents to have same id\n\t * of the initial page.\n\t */\n\tassertSameBodyIdInVirtualDocument() {\n\t\tvar bodySurface = this.virtualDocument.querySelector('body');\n\t\tif (!globals.document.body.id) {\n\t\t\tglobals.document.body.id = 'senna_surface_' + core.getUid();\n\t\t}\n\t\tif (bodySurface) {\n\t\t\tbodySurface.id = globals.document.body.id;\n\t\t}\n\t}\n\n\t/**\n\t * Copies attributes from the <html> tag of content to the given node.\n\t */\n\tcopyNodeAttributesFromContent_(content, node) {\n\t\tcontent = content.replace(/[<]\\s*html/ig, '<senna');\n\t\tcontent = content.replace(/\\/html\\s*\\>/ig, '/senna>');\n\t\tnode.innerHTML = content;\n\t\tvar placeholder = node.querySelector('senna');\n\t\tif (placeholder) {\n\t\t\tutils.clearNodeAttributes(node);\n\t\t\tutils.copyNodeAttributes(placeholder, node);\n\t\t}\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tdisposeInternal() {\n\t\tthis.disposePendingStyles();\n\t\tsuper.disposeInternal();\n\t}\n\n\t/**\n\t * Disposes pending styles if screen get disposed prior to its loading.\n\t */\n\tdisposePendingStyles() {\n\t\tif (this.pendingStyles) {\n\t\t\tthis.pendingStyles.forEach((style) => dom.exitDocument(style));\n\t\t}\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tevaluateScripts(surfaces) {\n\t\tvar evaluateTrackedScripts = this.evaluateTrackedResources_(\n\t\t\tglobalEval.runScriptsInElement, HtmlScreen.selectors.scripts,\n\t\t\tHtmlScreen.selectors.scriptsTemporary, HtmlScreen.selectors.scriptsPermanent);\n\n\t\treturn evaluateTrackedScripts.then(() => super.evaluateScripts(surfaces));\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tevaluateStyles(surfaces) {\n\t\tthis.pendingStyles = [];\n\t\tvar evaluateTrackedStyles = this.evaluateTrackedResources_(\n\t\t\tglobalEvalStyles.runStylesInElement, HtmlScreen.selectors.styles,\n\t\t\tHtmlScreen.selectors.stylesTemporary, HtmlScreen.selectors.stylesPermanent,\n\t\t\tthis.appendStyleIntoDocument_.bind(this));\n\n\t\treturn evaluateTrackedStyles.then(() => super.evaluateStyles(surfaces));\n\t}\n\n\t/**\n\t * Evaluates tracked resources inside incoming fragment and remove existing\n\t * temporary resources.\n\t * @param {?function()} appendFn Function to append the node into document.\n\t * @param {!string} selector Selector used to find resources to track.\n\t * @param {!string} selectorTemporary Selector used to find temporary\n\t *     resources to track.\n\t * @param {!string} selectorPermanent Selector used to find permanent\n\t *     resources to track.\n\t * @param {!function} opt_appendResourceFn Optional function used to\n\t *     evaluate fragment containing resources.\n\t * @return {CancellablePromise} Deferred that waits resources evaluation to\n\t *     complete.\n\t * @private\n\t */\n\tevaluateTrackedResources_(evaluatorFn, selector, selectorTemporary, selectorPermanent, opt_appendResourceFn) {\n\t\tvar tracked = this.virtualQuerySelectorAll_(selector);\n\t\tvar temporariesInDoc = this.querySelectorAll_(selectorTemporary);\n\t\tvar permanentsInDoc = this.querySelectorAll_(selectorPermanent);\n\n\t\t// Adds permanent resources in document to cache.\n\t\tpermanentsInDoc.forEach((resource) => {\n\t\t\tvar resourceKey = this.getResourceKey_(resource);\n\t\t\tif (resourceKey) {\n\t\t\t\tHtmlScreen.permanentResourcesInDoc[resourceKey] = true;\n\t\t\t}\n\t\t});\n\n\t\tvar frag = dom.buildFragment();\n\t\ttracked.forEach((resource) => {\n\t\t\tvar resourceKey = this.getResourceKey_(resource);\n\t\t\t// Do not load permanent resources if already in document.\n\t\t\tif (!HtmlScreen.permanentResourcesInDoc[resourceKey]) {\n\t\t\t\tfrag.appendChild(resource);\n\t\t\t}\n\t\t\t// If resource has key and is permanent add to cache.\n\t\t\tif (resourceKey && dom.match(resource, selectorPermanent)) {\n\t\t\t\tHtmlScreen.permanentResourcesInDoc[resourceKey] = true;\n\t\t\t}\n\t\t});\n\n\t\treturn new CancellablePromise((resolve) => {\n\t\t\tevaluatorFn(frag, () => {\n\t\t\t\ttemporariesInDoc.forEach((resource) => dom.exitDocument(resource));\n\t\t\t\tresolve();\n\t\t\t}, opt_appendResourceFn);\n\t\t});\n\t}\n\n\t/**\n\t * @Override\n\t */\n\tflip(surfaces) {\n\t\treturn super.flip(surfaces).then(() => {\n\t\t\tutils.clearNodeAttributes(document.documentElement);\n\t\t\tutils.copyNodeAttributes(this.virtualDocument, document.documentElement);\n\t\t});\n\t}\n\n\t/**\n\t * Extracts a key to identify the resource based on its attributes.\n\t * @param {Element} resource\n\t * @return {string} Extracted key based on resource attributes in order of\n\t *     preference: id, href, src.\n\t */\n\tgetResourceKey_(resource) {\n\t\treturn resource.id || resource.href || resource.src || '';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetSurfaceContent(surfaceId) {\n\t\tvar surface = this.virtualDocument.querySelector('#' + surfaceId);\n\t\tif (surface) {\n\t\t\tvar defaultChild = surface.querySelector('#' + surfaceId + '-' + Surface.DEFAULT);\n\t\t\tif (defaultChild) {\n\t\t\t\treturn defaultChild.innerHTML;\n\t\t\t}\n\t\t\treturn surface.innerHTML; // If default content not found, use surface content\n\t\t}\n\t}\n\n\t/**\n\t * Gets the title selector.\n\t * @return {!string}\n\t */\n\tgetTitleSelector() {\n\t\treturn this.titleSelector;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tload(path) {\n\t\treturn super.load(path)\n\t\t\t.then(content => {\n\t\t\t\tthis.allocateVirtualDocumentForContent(content);\n\t\t\t\tthis.resolveTitleFromVirtualDocument();\n\t\t\t\tthis.assertSameBodyIdInVirtualDocument();\n\t\t\t\tif (UA.isIe) {\n\t\t\t\t\tthis.makeTemporaryStylesHrefsUnique_();\n\t\t\t\t}\n\t\t\t\treturn content;\n\t\t\t});\n\t}\n\n\t/**\n\t * Queries temporary styles from virtual document, and makes them unique.\n\t * This is necessary for caching and load event firing issues specific to\n\t * IE11. https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7940171/\n\t */\n\tmakeTemporaryStylesHrefsUnique_() {\n\t\tvar temporariesInDoc = this.virtualQuerySelectorAll_(HtmlScreen.selectors.stylesTemporary);\n\t\ttemporariesInDoc.forEach((style) => this.replaceStyleAndMakeUnique_(style));\n\t}\n\n\t/**\n\t * Creates a new element from given, copies attributes, mutates href to be\n\t * unique to prevent caching and more than one load/error event from firing.\n\t */\n\treplaceStyleAndMakeUnique_(style) {\n\t\tif (style.href) {\n\t\t\tvar newStyle = globals.document.createElement(style.tagName);\n\t\t\tstyle.href = new Uri(style.href).makeUnique().toString();\n\t\t\tutils.copyNodeAttributes(style, newStyle);\n\t\t\tstyle.parentNode.replaceChild(newStyle, style);\n\t\t\tstyle.disabled = true;\n\t\t}\n\t}\n\n\t/**\n\t * Queries elements from virtual document and returns an array of elements.\n\t * @param {!string} selector\n\t * @return {array.<Element>}\n\t */\n\tvirtualQuerySelectorAll_(selector) {\n\t\treturn Array.prototype.slice.call(this.virtualDocument.querySelectorAll(selector));\n\t}\n\n\t/**\n\t * Queries elements from document and returns an array of elements.\n\t * @param {!string} selector\n\t * @return {array.<Element>}\n\t */\n\tquerySelectorAll_(selector) {\n\t\treturn Array.prototype.slice.call(globals.document.querySelectorAll(selector));\n\t}\n\n\t/**\n\t * Releases virtual document allocated for content.\n\t */\n\treleaseVirtualDocument() {\n\t\tthis.virtualDocument = null;\n\t}\n\n\t/**\n\t * Resolves title from allocated virtual document.\n\t */\n\tresolveTitleFromVirtualDocument() {\n\t\tvar title = this.virtualDocument.querySelector(this.titleSelector);\n\t\tif (title) {\n\t\t\tthis.setTitle(title.innerHTML.trim());\n\t\t}\n\t}\n\n\t/**\n\t * Sets the title selector.\n\t * @param {!string} titleSelector\n\t */\n\tsetTitleSelector(titleSelector) {\n\t\tthis.titleSelector = titleSelector;\n\t}\n\n}\n\n/**\n * Helper selectors for tracking resources.\n * @type {object}\n * @protected\n * @static\n */\nHtmlScreen.selectors = {\n\tscripts: 'script[data-senna-track]',\n\tscriptsPermanent: 'script[data-senna-track=\"permanent\"]',\n\tscriptsTemporary: 'script[data-senna-track=\"temporary\"]',\n\tstyles: 'style[data-senna-track],link[data-senna-track]',\n\tstylesPermanent: 'style[data-senna-track=\"permanent\"],link[data-senna-track=\"permanent\"]',\n\tstylesTemporary: 'style[data-senna-track=\"temporary\"],link[data-senna-track=\"temporary\"]'\n};\n\n/**\n * Caches permanent resource keys.\n * @type {object}\n * @protected\n * @static\n */\nHtmlScreen.permanentResourcesInDoc = {};\n\nexport default HtmlScreen;\n"],"sourceRoot":"/source/"}